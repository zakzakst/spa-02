<template>
  <div class="favorite-star__wrapper">
    <svg ref="favoriteStar" class="favorite-star" :class="{'is-active': isActive}" viewBox="0 0 36 36" @click="toggleFavorite">
      <g class="favorite-star__circles">
        <path class="favorite-star__circle" d="M18,21c0.552,0 1,0.449 1,1c0,0.552 -0.448,1 -1,1c-0.552,0 -1,-0.448 -1,-1c0,-0.551 0.448,-1 1,-1Z" />
        <path class="favorite-star__circle" d="M18,21c0.552,0 1,0.449 1,1c0,0.552 -0.448,1 -1,1c-0.552,0 -1,-0.448 -1,-1c0,-0.551 0.448,-1 1,-1Z" />
        <path class="favorite-star__circle" d="M18,21c0.552,0 1,0.449 1,1c0,0.552 -0.448,1 -1,1c-0.552,0 -1,-0.448 -1,-1c0,-0.551 0.448,-1 1,-1Z" />
        <path class="favorite-star__circle" d="M18,21c0.552,0 1,0.449 1,1c0,0.552 -0.448,1 -1,1c-0.552,0 -1,-0.448 -1,-1c0,-0.551 0.448,-1 1,-1Z" />
        <path class="favorite-star__circle" d="M18,21c0.552,0 1,0.449 1,1c0,0.552 -0.448,1 -1,1c-0.552,0 -1,-0.448 -1,-1c0,-0.551 0.448,-1 1,-1Z" />
      </g>
      <path class="favorite-star__star" d="M16.434,13.378c0.294,-0.596 0.901,-0.973 1.566,-0.973c0.665,0 1.272,0.377 1.566,0.973l1.738,3.521c0.254,0.515 0.746,0.873 1.314,0.955l3.886,0.565c0.658,0.096 1.205,0.557 1.41,1.189c0.206,0.632 0.035,1.326 -0.442,1.79l-2.811,2.741c-0.412,0.401 -0.6,0.979 -0.503,1.545l0.664,3.87c0.113,0.656 -0.157,1.318 -0.695,1.708c-0.538,0.391 -1.25,0.442 -1.839,0.133l-3.476,-1.827c-0.508,-0.267 -1.116,-0.267 -1.625,0l-3.475,1.827c-0.589,0.309 -1.302,0.258 -1.839,-0.133c-0.538,-0.39 -0.808,-1.052 -0.695,-1.708l0.664,-3.87c0.097,-0.566 -0.091,-1.144 -0.503,-1.545l-2.811,-2.741c-0.477,-0.464 -0.648,-1.158 -0.442,-1.79c0.205,-0.632 0.752,-1.093 1.41,-1.189l3.886,-0.565c0.568,-0.082 1.06,-0.44 1.314,-0.955l1.738,-3.521Z" />
    </svg>
  </div>
</template>

<script>
import gsap from 'gsap'

export default {
  props: ['isActive'],
  data() {
    return {
      svg: null,
      star: null,
      circles: null,
      starPath: {
        base: 'M16.434,13.378c0.294,-0.596 0.901,-0.973 1.566,-0.973c0.665,0 1.272,0.377 1.566,0.973l1.738,3.521c0.254,0.515 0.746,0.873 1.314,0.955l3.886,0.565c0.658,0.096 1.205,0.557 1.41,1.189c0.206,0.632 0.035,1.326 -0.442,1.79l-2.811,2.741c-0.412,0.401 -0.6,0.979 -0.503,1.545l0.664,3.87c0.113,0.656 -0.157,1.318 -0.695,1.708c-0.538,0.391 -1.25,0.442 -1.839,0.133l-3.476,-1.827c-0.508,-0.267 -1.116,-0.267 -1.625,0l-3.475,1.827c-0.589,0.309 -1.302,0.258 -1.839,-0.133c-0.538,-0.39 -0.808,-1.052 -0.695,-1.708l0.664,-3.87c0.097,-0.566 -0.091,-1.144 -0.503,-1.545l-2.811,-2.741c-0.477,-0.464 -0.648,-1.158 -0.442,-1.79c0.205,-0.632 0.752,-1.093 1.41,-1.189l3.886,-0.565c0.568,-0.082 1.06,-0.44 1.314,-0.955l1.738,-3.521Z',
        anim: 'M15.807,9.929c0.412,-0.835 1.262,-1.363 2.193,-1.363c0.931,0 1.781,0.528 2.193,1.363l2.432,4.929c0.357,0.722 1.044,1.222 1.841,1.338l5.44,0.79c0.921,0.134 1.686,0.779 1.974,1.665c0.288,0.884 0.048,1.856 -0.619,2.506l-3.936,3.836c-0.576,0.563 -0.839,1.372 -0.703,2.165l0.929,5.417c0.158,0.918 -0.22,1.845 -0.973,2.392c-0.753,0.547 -1.751,0.618 -2.574,0.186l-4.867,-2.558c-0.711,-0.375 -1.563,-0.375 -2.275,0l-4.866,2.558c-0.823,0.432 -1.821,0.361 -2.574,-0.186c-0.754,-0.547 -1.131,-1.474 -0.973,-2.392l0.929,-5.417c0.136,-0.793 -0.127,-1.602 -0.703,-2.165l-3.936,-3.836c-0.667,-0.65 -0.907,-1.622 -0.619,-2.506c0.288,-0.886 1.053,-1.531 1.974,-1.665l5.44,-0.79c0.796,-0.116 1.484,-0.617 1.841,-1.338l2.432,-4.929Z'
      },
      circlesPath: [
        {
          base: 'M18,21c0.552,0 1,0.449 1,1c0,0.552 -0.448,1 -1,1c-0.552,0 -1,-0.448 -1,-1c0,-0.551 0.448,-1 1,-1Z',
          anim: 'M3,12c1.103,0 2,0.897 2,2c0,1.104 -0.897,2 -2,2c-1.103,0 -2,-0.896 -2,-2c0,-1.103 0.897,-2 2,-2Z',
        },
        {
          base: 'M18,21c0.552,0 1,0.449 1,1c0,0.552 -0.448,1 -1,1c-0.552,0 -1,-0.448 -1,-1c0,-0.551 0.448,-1 1,-1Z',
          anim: 'M8,4c1.103,0 2,0.897 2,2c0,1.103 -0.897,2 -2,2c-1.103,0 -2,-0.897 -2,-2c0,-1.103 0.897,-2 2,-2Z',
        },
        {
          base: 'M18,21c0.552,0 1,0.449 1,1c0,0.552 -0.448,1 -1,1c-0.552,0 -1,-0.448 -1,-1c0,-0.551 0.448,-1 1,-1Z',
          anim: 'M18,1c1.103,0 2,0.897 2,2c0,1.103 -0.897,2 -2,2c-1.103,0 -2,-0.897 -2,-2c0,-1.103 0.897,-2 2,-2Z',
        },
        {
          base: 'M18,21c0.552,0 1,0.449 1,1c0,0.552 -0.448,1 -1,1c-0.552,0 -1,-0.448 -1,-1c0,-0.551 0.448,-1 1,-1Z',
          anim: 'M27,4c1.103,0 2,0.897 2,2c0,1.103 -0.897,2 -2,2c-1.103,0 -2,-0.897 -2,-2c0,-1.103 0.897,-2 2,-2Z',
        },
        {
          base: 'M18,21c0.552,0 1,0.449 1,1c0,0.552 -0.448,1 -1,1c-0.552,0 -1,-0.448 -1,-1c0,-0.551 0.448,-1 1,-1Z',
          anim: 'M33,12c1.103,0 2,0.897 2,2c0,1.104 -0.897,2 -2,2c-1.103,0 -2,-0.896 -2,-2c0,-1.103 0.897,-2 2,-2Z',
        },
      ],
      // isActive: false,
    }
  },
  methods: {
    toggleFavorite() {
      if(this.isActive) {
        this.isActive = false;
      } else {
        this.isActive = true;
        this.animStar();
        this.animCircles();
      }
    },
    animStar() {
      this.star.animate({
        d: this.starPath.anim,
      }, 150, mina.easein, () => {
        this.star.animate({
          d: this.starPath.base,
        }, 200, mina.backout);
      });
    },
    animCircles() {
      for(let i = 0; i < this.circles.length; i++) {
        const circle = this.circles[i];
        circle.attr({
          fillOpacity: 1,
        });
        circle.animate({
          d: this.circlesPath[i].anim,
        }, 300, mina.easeout, () => {
          circle.attr({
            fillOpacity: null,
          });
        });
        setTimeout(() => {
          circle.animate({
            d: this.circlesPath[i].base,
          }, 0);
        }, 300);
      }
    }
  },
  mounted() {
    // 要素の設定
    this.svg = Snap(this.$refs.favoriteStar);
    this.star = this.svg.select('.favorite-star__star');
    this.circles = this.svg.selectAll('.favorite-star__circle');
    console.log(this.svg, this.star, this.circles);
  }
}
</script>

<style lang="scss">
.favorite-star__wrapper {
  position: relative;
  display: inline-block;
  width: 24px;
  height: 24px;
  cursor: pointer;
}
.favorite-star {
  position: absolute;
  bottom: 0;
  left: -6px;
  width: 36px;
  height: 36px;
}
.favorite-star__star {
  fill: #888;
  transition: fill .2s;
}
.favorite-star__circles {
  fill: #fb0;
  fill-opacity: 0;
  transition: fill-opacity .2s;
}

// アクティブ時のスタイル
.favorite-star.is-active {
  .favorite-star__star {
    fill: #fb0;
  }
}
</style>
